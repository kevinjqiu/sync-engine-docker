version: "2"
services:
    engine:
        build: .
        image: kevinjqiu/nylas-sync-engine
        links:
            - redis:redis
            - db1:db1
            - db2:db2
        volumes:
            - ./sync-engine:/app
            #- ./data:/var/lib/inboxapp
            - ./config:/etc/inboxapp
        command: bin/inbox-start
        environment:
            FIRST_RUN: 0  # need to run bin/create-db if FIRST_RUN
    api:
        build: .
        image: kevinjqiu/nylas-sync-engine
        links:
            - redis:redis
            - db1:db1
            - db2:db2
        ports:
            - "5555:5555"
        volumes:
            - ./sync-engine:/app
            #- ./data:/var/lib/inboxapp
            - ./config:/etc/inboxapp
        command: bin/inbox-api
    redis:
        image: redis
    db1:
        image: mysql
        environment:
            MYSQL_USER: root
            MYSQL_ROOT_PASSWORD: root
    db2:
        image: mysql
        environment:
            MYSQL_USER: root
            MYSQL_ROOT_PASSWORD: root
